<html>

<head>
    <title>HTML5 Canvas Winning Wheel</title>
    <link rel="stylesheet" href="main.css" type="text/css" />
    <script type="text/javascript" src="./libs/winwheel/Winwheel.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js"></script>
</head>

<body>
    <div class="wheel-container">
        <canvas id="canvas" width="434" height="434">
            <p align="center">Sorry, your browser doesn't support canvas. Please try another.</p>
        </canvas>
        <br />
        <button id="spinButton" class="spin-button" onclick="startSpin();">QUAY NGAY</button>
    </div>
    <script>
        // Create new wheel object specifying the parameters at creation time.
        let theWheel = new Winwheel({
            'numSegments': 4,     // Specify number of segments.
            'outerRadius': 212,   // Set outer radius so wheel fits inside the background.
            'textFontSize': 16,    // Set font size as desired.
            'segments':        // Define segments including colour and text.
                [
                    { 'fillStyle': '#eae56f', 'text': 'Giải nhất' },
                    { 'fillStyle': '#89f26e', 'text': 'Giải nhì' },
                    { 'fillStyle': '#7de6ef', 'text': 'Giải ba' },
                    { 'fillStyle': '#e7706f', 'text': 'Giải bốn' }
                ],
            'animation':           // Specify the animation to use.
            {
                'type': 'spinToStop',
                'duration': 5,     // Duration in seconds.
                'spins': 8,     // Number of complete spins.
                'callbackFinished': alertPrize
            }
        });

        // Function with formula to work out stopAngle before spinning animation.
        // Called from Click of the Spin button.
        function calculatePrize() {
            // Define the angles for different prizes
            const giaiba = 181;
            const giaibon = 271;
            
            // Randomly choose between giaiba and giaibon
            const randomChoice = Math.random() < 0.5 ? giaiba : giaibon;
            
            // Calculate the stop angle with a small random offset (1-88 degrees)
            let stopAt = randomChoice + Math.floor(Math.random() * 88);

            // Important thing is to set the stopAngle of the animation before starting the spin.
            theWheel.animation.stopAngle = stopAt;

            // Start the spin
            theWheel.startAnimation();
        }

        // Click handler for spin button.
        function startSpin() {
            // Set spinning flag
            wheelSpinning = true;
            
            // Use the new calculatePrize function
            calculatePrize();
            
            return true;
        }


        // Called when the spin animation has finished by the callback feature of the wheel because I specified callback in the parameters
        // note the indicated segment is passed in as a parmeter as 99% of the time you will want to know this to inform the user of their prize.
        // -------------------------------------------------------
        function alertPrize(indicatedSegment) {
            // Do basic alert of the segment text. You would probably want to do something more interesting with this information.
            alert("You have won " + indicatedSegment.text);
        }
    </script>
</body>

</html>